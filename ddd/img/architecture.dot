digraph architecture {
    splines=false

    subgraph cluster_req {
        r1[label="外部请求"]
        r2[label="外部请求"]
        r3[label="外部请求"]
        // r1->r2->r3[style=invis]
        border=false
        color=none
    }
    subgraph cluster_entry{
        // i[style=invis;height=0;rank=source]
        // i->{a0,a1,a2}[style=invis]
        node[style="filled";fillcolor=white]
        a2[label="Thrift适配器";shape=box;width=1];
        a0[label="HTTP适配器";shape=octagon;];
        a1[label="Dubbo适配器";shape=diamond;height=1];
        {a0,a1,a2}[rank=same];
        fontsize=20;
        label="访问适配层";
        style=filled;
        fillcolor="#ccffcc";   
        compound=true;
    }

    {a0,a1,a2}->entry[ltail=cluster_entry,lhead=cluster_domain]
    subgraph cluster_domain{
        node[style=filled;fillcolor=white]
        edge[color=blue];

        entry[label="应用程序";style="filled,invis";shape=hexagon;fillcolor="#66ccff";rank=source]
        o[label="领域对象";shape=circle]
        repo[label="资源库(Repo)";shape=cylinder];
        d_ser[label="领域服务"];

        edge[style="invis"]
        entry->repo
        entry->repo
        entry->o
        entry->o
        entry->d_ser
        entry->d_ser
        labelloc=t;
        
        label="应用服务";
        fontsize=20;
        style=filled;
        fillcolor="#ffff80";
        out[style=invisible;rank=min]
        compound=true;
    }


    edge[head=invis;headport=w]
    d_ser->in
    repo->in
    edge[headport=none]
    subgraph cluster_infr{
        in[style=invisible;rank=same;height=0;width=0]
        node[style=filled;fillcolor=white]
        db[label="数据库";shape=cylinder]
        mq[label="消息中间件"]
        ex_ser[label="外部服务"];
        edge[style=invis];
        _r[style=invis;]
        
        in->db,mq,ex_ser
        
        fontsize=20;
        label="基础设施";
        style=filled;
        compound=true;
        fillcolor="#ff6600";
    }


    r1->a0
    r2->a1
    r3->a2
    {r1,r2,r3}[rank=min]
    a1->o[style=invis]
    o->repo[style=invis]
    o->d_ser[style=invis]
    fontsize=20;
    label="一个可能的 DDD 架构";

}
